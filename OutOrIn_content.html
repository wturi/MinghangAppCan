<!DOCTYPE html>
<html class="um landscape min-width-240px min-width-320px min-width-480px min-width-768px min-width-1024px">

<head>
    <title></title>
    <meta charset="utf-8">
    <meta name="viewport" content="target-densitydpi=device-dpi, width=device-width, initial-scale=1, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <link href="bootstrap/css/bootstrap.css" rel="stylesheet" />
    <link href="bootstrap/DateTime/bootstrap-datetimepicker.min.css" rel="stylesheet" />
    <link href="bootstrap/DateTime/bootstrap-datetimepicker.css" rel="stylesheet" />
    <style type="text/css">
        .row {
            margin-top: 1.5em;
            margin-left: 0.5em;
            margin-right: 0.5em;
        }
        
        .alert-dismissible {
            display: inline-block;
            padding-top: 0.3em;
            padding-bottom: 0.55em;
            margin-right: 0.3em;
        }
        
        .panel-body {
            padding: 0;
        }
        
        .panel-heading {
            height: 55px;
        }
        
        #myModalPiZhun .modal-body button {
            margin: 0.5em 0.7em;
        }
    </style>
</head>

<body class="um-vp bc-bg" ontouchstart>
    <div class="row">
        <div class="col-md-12 col-xs-12">
            <select class="form-control selectval">
                <option value="-1">请选择进出类型</option>
                <option value="1">入园申请</option>
                <option value="2">出园申请</option>
            </select>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <input type="text" class="form-control" id="PeblishTitle" placeholder="请输入标题">
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <textarea class="form-control" id="PublishContent" rows="6" placeholder="请输入内容"></textarea>
        </div>
    </div>
    <div class="row">
        <div class="col-md-12">
            <!-- 人员 -->
            <div class="panel panel-default">
                <input type="hidden" id="Peopleid" />
                <div class="panel-heading">
                    <h4 class="pull-left">人员</h4>
                    <button type="button" class="btn btn-success pull-right tianjia" tag="1" data-toggle="modal" data-target="#myModalPeople">+ 添加</button>
                </div>
                <div class="panel-body">
                    <div>
                        <table class="table table-striped table-hover"></table>
                    </div>
                </div>
            </div>
            <!-- 车辆 -->
            <div class="panel panel-default">
                <input type="hidden" id="Carid" />
                <div class="panel-heading">
                    <h4 class="pull-left">车辆</h4>
                    <button type="button" class="btn btn-success pull-right tianjia" tag="2" data-toggle="modal" data-target="#myModalCar">+ 添加</button>
                </div>
                <div class="panel-body">
                    <div>
                        <table class="table table-striped table-hover"></table>
                    </div>
                </div>
            </div>
            <!-- 物品 -->
            <div class="panel panel-default">
                <input type="hidden" id="Productid" />
                <div class="panel-heading">
                    <h4 class="pull-left">物品</h4>
                    <button type="button" class="btn btn-success pull-right tianjia" tag="3" data-toggle="modal" data-target="#myModalProduct">+ 添加</button>
                </div>
                <div class="panel-body">
                    <div>
                        <table class="table table-striped table-hover"></table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-md-2"></div>
        <div class="col-md-8 text-center">
            <button type="button" id="btnzong" class="btn btn-info">确认提交</button>
        </div>
        <div class="col-md-2"></div>
    </div>
    <br />
    <br />
    <br />

    <!--人员选择框 -->
    <div class="modal fade" id="myModalPeople" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h4 class="modal-title" id="myModalLabel">人员选择</h4>
                </div>
                <div class="modal-body">
                    <div class="input-group">
                        <input type="text" name="q" class="form-control search" placeholder="搜索..." />
                        <span class="input-group-btn">
                            <button type='submit' name='search' id='search-btn-people' class="btn btn-flat"> 
                               <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
                        </button>
                        </span>
                    </div>
                    <div class="divtable">
                        <table class="table table-striped table-hover">
                            <thead>
                                <tr>
                                    <th>姓名</th>
                                    <th>性别</th>
                                    <th>电话</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!--车辆选择框 -->
    <div class="modal fade" id="myModalCar" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h4 class="modal-title" id="myModalLabel">车辆选择</h4>
                </div>
                <div class="modal-body">
                    <div class="input-group">
                        <input type="text" name="q" class="form-control search" placeholder="搜索..." />
                        <span class="input-group-btn">
                            <button type='submit' name='search' id='search-btn-car' class="btn btn-flat"> 
                                <span class="glyphicon glyphicon-search"></span>
                        </button>
                        </span>
                    </div>
                    <div class="divtable">
                        <table class="table table-striped table-hover">
                            <thead>
                                <tr>
                                    <th>车牌号</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!--物品选择框 -->
    <div class="modal fade" id="myModalProduct" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h4 class="modal-title" id="myModalLabel">物品选择</h4>
                </div>
                <div class="modal-body">
                    <div class="input-group">
                        <input type="text" name="q" class="form-control search" placeholder="搜索..." />
                        <span class="input-group-btn">
                            <button type='submit' name='search' id='search-btn-product' class="btn btn-flat">
                               <span class="glyphicon glyphicon-search" aria-hidden="true"></span>
                        </button>
                        </span>
                    </div>
                    <div class="divtable">
                        <table class="table table-striped table-hover">
                            <thead>
                                <tr>
                                    <th>物品名称</th>
                                    <th>数量</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="js/jQuery-2.1.4.min.js"></script>
    <script src="js/bootstrap-datetimepicker.js"></script>
    <script src="bootstrap/js/bootstrap.js"></script>
    <script src="js/AllParamter.js"></script>
    <script src="js/appcan.js"></script>
    <script src="js/appcan.control.js"></script>
    <script type="text/javascript">
        //点击添加按钮 弹出模态框 >>> 多条件 多关键字 查询
    $(".tianjia").click(function () {
        var tag = $(this).attr('tag');
        var id = $(this).attr('data-target');
        $(id).find('.search').val('');
        var str = $.trim($(id).find('.search').val().replace(/\s+/g, " "));
        if (tag == '1') {
            SelectPeople(id, str, tag);
        } else if (tag == '2') {
            SelectCar(id, str, tag);
        } else if (tag == '3') {
            SelectProduct(id, str, tag);
        }

        //多条件查询
        $(id).find('#search-btn-people').click(function () {
            var str1 = $.trim($(id).find('.search').val().replace(/\s+/g, " "));
            SelectPeople(id, str1, tag);
        })

        $(id).find('#search-btn-car').click(function () {
            var str1 = $.trim($(id).find('.search').val().replace(/\s+/g, " "));
            SelectCar(id, str1, tag);
        })

        $(id).find('#search-btn-product').click(function () {
            var str1 = $.trim($(id).find('.search').val().replace(/\s+/g, " "));
            SelectProduct(id, str1, tag);
        })
    })



        //People数据
        function SelectPeople(id, str, tag) {
            var userid=window.localStorage.useid;
            appcan.request.ajax({
                    type: "get",
                    async: false,
                    dataType: "jsonp",
                    url: webserviceurl,
                    data: { 
                        type: "OutOrInShuju",
                        outorin: tag,
                        useid:userid,
                        suotext:str
                    },
                    jsonp: "callback",
                    success:function(data){
                        var str1='';
                        $.each(data, function (i, item) {
                        str1 += '<tr><td>' + item.PeopleName + '</td>' +
                            '<td>' + item.Sexy + '</td>' +
                            '<td>' + item.PhoneNum + '</td>' +
                            '<td><a class="btn btn-success xuanze" tag="' + item.PeopleID + '">选择</a></td></tr>';
                    })
                    $(id).find('tbody').empty().append(str1);
                       
                    }
            })
        }

         //Car数据
        function SelectCar(id, str, tag) {
          appcan.request.ajax({
                        type: "get",
                        async: false,
                        dataType: "jsonp",
                        url: webserviceurl,
                        data: { 
                            type: "OutOrInShuju", 
                            outorin: tag,
                            useid:window.localStorage.useid,
                            suotext:str
                        },
                        jsonp: "callback",
                        timeout: 3000,
                        success:function(data){
                            var str1 = '';
                    $.each(data, function (i, item) {
                        str1 += '<tr><td>' + item.CarLicence + '</td>' +
                            '<td><a class="btn btn-success xuanze" tag="' + item.CarID + '">选择</a></td></tr>';
                    })
                    $(id).find('tbody').empty().append(str1);
                        }
                })
        }

         //Product数据
        function SelectProduct(id, str, tag) {
            appcan.request.ajax({
                    type: "get",
                    async: false,
                    dataType: "jsonp",
                    url: webserviceurl,
                    data: { 
                        type: "OutOrInShuju", 
                        outorin: tag,
                        useid:window.localStorage.useid,
                        suotext:str
                    },
                    jsonp: "callback",
                    timeout: 3000,
                    success:function(data){
                       var str1 = '';
                        $.each(data, function (i, item) {
                            str1 += '<tr><td>' + item.ProductName + '</td>' +
                                '<td>' + item.ProductQuantity + '</td>' +
                                '<td><a class="btn btn-success xuanze" tag="' + item.CarID + '">选择</a></td></tr>';
                        })
                        $(id).find('tbody').empty().append(str1);
                    }
            })
        }

        //选择人车物添加到页面
        $(document).on('click', '.xuanze', function () {
            var ide = $(this).attr('tag');
            var id = '#' + $(this).parent().parent().parent().parent().parent().parent().parent().parent().parent().attr('id').replace('myModal', '') + 'id';
            var ides = $.trim($(id).val()).split(' ');
            for (var i = 0; i < ides.length; i++) {//判断是否已存在
                if (ide == ides[i]) {
                    alert("已选择过！");
                    return false;
                }
            }
            $(id).val($(id).val() + ' ' + ide);
            var html = $(this).parent().parent().html();
            html = html.replace('选择', '删除').replace('xuanze', 'shanchu').replace('success', 'warning');
            $(id).parent().find('table').append('<tr>' + html + '</tr>');

            $(this).parent().parent().remove();

        })

         //删除已选择的人车物
        $(document).on('click', '.shanchu', function () {
            var tag = $(this).attr('tag');
            var id = $(this).parent().parent().parent().parent().parent().parent().parent().children().eq(0);
            id.val($.trim(id.val().replace(tag, '')));
            $(this).parent().parent().remove();
        })

         $('#btnzong').click(function () {
            submitpcp();
        })

         //提交数据
        function submitpcp() {
            var InOutType = $('.selectval').val();
            var CheckTitle = $('#PeblishTitle').val();
            var CheckContent = $('#PublishContent').val();
            var people = $('#Peopleid').val().trim();
            var car = $('#Carid').val().trim();
            var product = $('#Productid').val().trim();

            var userid=window.localStorage.useid;

            if(InOutType=='-1'){
                appcan.window.openToast("请选择进出类型",1000);
                return false;
            }
            if(CheckTitle==''||CheckTitle==null){
                appcan.window.openToast("请输入标题",1000);
                return false;
            }
            if(CheckContent==''||CheckContent==null){
                appcan.window.openToast("请输入内容",1000);
                return false;
            }


            appcan.request.ajax({
                    type: "get",
                    async: false,
                    dataType: "jsonp",
                    url: webserviceurl,
                    data: { 
                        type: "OutOrIninsert",
                        outorin: InOutType,
                        useid:userid,
                        title:CheckTitle,
                        content:CheckContent,
                        Peopleid:people,
                        Carid:car,
                        Productid:product
                    },
                    jsonp: "callback",
                    success:function(data){
                        if(data==1){
                            appcan.window.openToast('申请成功!',1000);
                            setTimeout(function(){
                               appcan.window.evaluateScript({name:'myshenqingcontent',scriptContent:'appcan.window.close(-1);'}); 
                            },1500);
                        }else{
                             appcan.window.openToast('网络错误，请重新申请!',1000);
                        }
                    }

            })
        }
    </script>
</body>

</html>